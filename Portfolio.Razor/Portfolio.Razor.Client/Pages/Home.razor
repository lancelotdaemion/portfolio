@page "/"

@using Microsoft.AspNetCore.SignalR.Client
@using Portfolio.Blazor
@using MudBlazor
@using System.Collections.ObjectModel
@using System.Net.Http
@using System.Net.Http.Json

<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
<link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />

<script src="_content/MudBlazor/MudBlazor.min.js"></script>

<PageTitle>Home</PageTitle>

@* Required *@
<MudThemeProvider />
<MudPopoverProvider />

@* Needed for dialogs *@
<MudDialogProvider />

@* Needed for snackbars *@
<MudSnackbarProvider />

<MudButton OnClick="RemoveItem">fsfd</MudButton>

<MudDataGrid Items="@_ipsums">
    <Columns>
        <PropertyColumn Property="x => x.Name" Title="Nr" />
        <PropertyColumn Property="x => x.Value" />
        <PropertyColumn Property="x => x.PercentageChange" />
    </Columns>
</MudDataGrid>

@code {
    private HubConnection _hubConnection;
    private ObservableCollection<LoremIpsum> _ipsums;

    protected override async Task OnInitializedAsync()
    {
        using (var httpClient = new HttpClient())
        {
            var client = new HttpClient();
            using (var response = await client.GetAsync("https://localhost:7055/api/Ipsums"))
            {
                _ipsums = await response.Content.ReadFromJsonAsync<ObservableCollection<LoremIpsum>>();
            }
        }

        _hubConnection = new HubConnectionBuilder()
                                .WithUrl("https://localhost:7055/lorem_ipsum_notifications")
                                .Build();

        _hubConnection.On<LoremIpsum>("ReceivedNotification", message =>
        {
            InvokeAsync(StateHasChanged);
        });

        await _hubConnection.StartAsync();
    }

    public void RemoveItem()
    {
        //_ipsums.RemoveAt(1);

        _ipsums.ElementAt(1).Name = "blah";
    }
}
